dnl Test suite containing tests that don't fit another file
AT_BANNER([------------------  AGGREGATION TESTS -----------------------])

dnl Here we try to change the values of an existing variable, which is disallowed in this version
AT_ASSERT_PARSE_ERROR([agg/error_multi_aggs.ncml])
AT_ASSERT_PARSE_ERROR([agg/error_improper_netcdf_loc.ncml])
AT_ASSERT_PARSE_ERROR([agg/error_agg_in_wrong_loc_1.ncml])
AT_ASSERT_PARSE_ERROR([agg/error_agg_in_wrong_loc_2.ncml])
AT_ASSERT_PARSE_ERROR([agg/error_agg_bad_attr.ncml])

dnl UNION : Acceptance tests on attributes and variables for union
dnl First, test a basic purely virtual dataset one level deep aggregates correctly.
AT_CHECK_ALL_DAP_RESPONSES([agg/virtual_union.ncml])
AT_CHECK_DATADDS_GETDAP([agg/virtual_union.ncml])

dnl TODO test a two level nest to make sure that works correctly
AT_CHECK_ALL_DAP_RESPONSES([agg/multi_nested_unions.ncml])
AT_CHECK_DATADDS_GETDAP([agg/multi_nested_unions.ncml])

dnl TODO test that NcML transformations can be applied to data AFTER
dnl it has been aggregated.  
AT_CHECK_ALL_DAP_RESPONSES([agg/modify_post_union.ncml])
AT_CHECK_DATADDS_GETDAP([agg/modify_post_union.ncml])

dnl Test from the Unidata NCML Aggregation tutorial
AT_CHECK_ALL_DAP_RESPONSES([agg/aggUnionSimple.ncml])

dnl----------------- Dimensions ---------------------------
dnl Test example virtual datasets with dimensions.

dnl Check that a union with correct matching dimensions works
dnl Technically, there's nothing to check since the dims are used 
dnl inside the child datasets to generate data, and not otherwise...
dnl Only shared would technically need to match, but DAP2 doesn't have them yet...
AT_CHECK_ALL_DAP_RESPONSES([agg/union_with_dimensions.ncml])
AT_CHECK_DATADDS_GETDAP([agg/union_with_dimensions.ncml])

dnl Check parse error on a dimension mismatch in the union
dnl This is where we'd have to make the error...  We're not
dnl going to traverse into DAP objects to check dimensions for now...
AT_ASSERT_PARSE_ERROR([agg/union_dimension_mismatch_error.ncml])

dnl TODO Find some actual aggregation data somewhere and run it
dnl through TDS maybe?



